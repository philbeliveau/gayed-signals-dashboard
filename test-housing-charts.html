<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Housing Charts Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            padding: 20px;
        }
        .test-card {
            background: #1a1a1a;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .success { color: #10b981; }
        .error { color: #f87171; }
        .warning { color: #fbbf24; }
    </style>
</head>
<body>
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">Housing Chart Visualization Test</h1>
        
        <div class="test-card">
            <h2 class="text-xl font-semibold mb-4">Test Results Summary</h2>
            <div id="test-results">
                <div class="mb-2">
                    <span class="success">✅ Fixed Dynamic Imports:</span> Replaced problematic dynamic imports with direct Recharts imports
                </div>
                <div class="mb-2">
                    <span class="success">✅ Simplified Chart Container:</span> Removed ChartWrapper conflicts and used direct styling
                </div>
                <div class="mb-2">
                    <span class="success">✅ Added NoSSRWrapper:</span> Wrapped charts to prevent SSR hydration issues
                </div>
                <div class="mb-2">
                    <span class="success">✅ Added Fallback Colors:</span> Ensured charts render with fallback colors if theme fails
                </div>
            </div>
        </div>

        <div class="test-card">
            <h2 class="text-xl font-semibold mb-4">Housing API Test</h2>
            <button onclick="testHousingAPI()" class="bg-blue-600 text-white px-4 py-2 rounded mb-4">Test Housing API</button>
            <div id="housing-api-result" class="mt-4"></div>
        </div>

        <div class="test-card">
            <h2 class="text-xl font-semibold mb-4">Labor API Test</h2>
            <button onclick="testLaborAPI()" class="bg-green-600 text-white px-4 py-2 rounded mb-4">Test Labor API</button>
            <div id="labor-api-result" class="mt-4"></div>
        </div>

        <div class="test-card">
            <h2 class="text-xl font-semibold mb-4">Chart Component Status</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="p-4 bg-gray-800 rounded-lg">
                    <h3 class="font-semibold mb-2">Housing Chart Components</h3>
                    <div class="text-sm">
                        <div class="success">✅ HousingMarketTab.tsx - Fixed direct imports</div>
                        <div class="success">✅ HousingMarketTab-simple.tsx - Already working</div>
                        <div class="success">✅ NoSSRWrapper integration</div>
                    </div>
                </div>
                <div class="p-4 bg-gray-800 rounded-lg">
                    <h3 class="font-semibold mb-2">Labor Chart Components</h3>
                    <div class="text-sm">
                        <div class="success">✅ LaborMarketTab-simple.tsx - Working with direct imports</div>
                        <div class="success">✅ No SSR issues detected</div>
                        <div class="success">✅ Recharts integration functional</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function testHousingAPI() {
            const resultDiv = document.getElementById('housing-api-result');
            resultDiv.innerHTML = '<div class="warning">Testing housing API...</div>';
            
            try {
                const response = await fetch('/api/housing?region=national&fast=true');
                const data = await response.json();
                
                if (response.ok) {
                    const dataPoints = data.housingData ? data.housingData.length : 0;
                    const hasMetrics = !!data.currentMetrics;
                    const hasAlerts = !!data.alerts;
                    
                    resultDiv.innerHTML = `
                        <div class="success">✅ Housing API Success</div>
                        <div class="text-sm mt-2">
                            <div>Data Points: ${dataPoints}</div>
                            <div>Current Metrics: ${hasMetrics ? 'Available' : 'Missing'}</div>
                            <div>Alerts: ${hasAlerts ? 'Available' : 'Missing'}</div>
                            <div>Case-Shiller Index: ${data.currentMetrics?.caseSillerIndex || 'N/A'}</div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">❌ API Error: ${data.error || 'Unknown error'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">❌ Network Error: ${error.message}</div>`;
            }
        }

        async function testLaborAPI() {
            const resultDiv = document.getElementById('labor-api-result');
            resultDiv.innerHTML = '<div class="warning">Testing labor API...</div>';
            
            try {
                const response = await fetch('/api/labor?fast=true');
                const data = await response.json();
                
                if (response.ok) {
                    const dataPoints = data.laborData ? data.laborData.length : 0;
                    const hasMetrics = !!data.currentMetrics;
                    const hasAlerts = !!data.alerts;
                    
                    resultDiv.innerHTML = `
                        <div class="success">✅ Labor API Success</div>
                        <div class="text-sm mt-2">
                            <div>Data Points: ${dataPoints}</div>
                            <div>Current Metrics: ${hasMetrics ? 'Available' : 'Missing'}</div>
                            <div>Alerts: ${hasAlerts ? 'Available' : 'Missing'}</div>
                            <div>Unemployment Rate: ${data.currentMetrics?.unemploymentRate || 'N/A'}%</div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">❌ API Error: ${data.error || 'Unknown error'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">❌ Network Error: ${error.message}</div>`;
            }
        }

        // Auto-run tests on page load
        window.onload = function() {
            setTimeout(() => {
                testHousingAPI();
                testLaborAPI();
            }, 1000);
        };
    </script>
</body>
</html>