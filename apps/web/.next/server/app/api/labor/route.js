(()=>{var e={};e.id=412,e.ids=[412],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30585:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>S,routeModule:()=>d,serverHooks:()=>g,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>p});var a={};r.r(a),r.d(a,{GET:()=>u,OPTIONS:()=>m});var s=r(48106),i=r(48819),o=r(12050),n=r(4235),l=r(75492);let c={info:e=>console.log(`‚ÑπÔ∏è Labor API: ${e}`),warn:e=>console.warn(`‚ö†Ô∏è Labor API: ${e}`),error:(e,t)=>console.error(`‚ùå Labor API: ${e}`,t)},h=new Map;async function u(e){try{let t=Date.now();for(let[e,r]of h.entries())t>r.timestamp+r.ttl&&h.delete(e);let r=new URL(e.url),a=r.searchParams.get("period")||"12m",s="true"===r.searchParams.get("fast"),i=`labor_${a}_${s}`,o=function(e){let t=h.get(e);return t?Date.now()>t.timestamp+t.ttl?(h.delete(e),null):t.data:null}(i);if(o)return c.info(`üöÄ Returning cached labor data for period: ${a}`),n.NextResponse.json({...o,cached:!0,cacheTime:new Date().toISOString()});c.info(`üë• Fetching labor data for period: ${a}, fast: ${s}`);let u=(0,l.TG)(),m=["UNRATE","PAYEMS","ICSA","CCSA","IC4WSA","CIVPART","EMRATIO","UNEMPLOY","JTSJOL","JTSQUR"],d=new Date,f=new Date;if("max"===a||"all"===a)f.setFullYear(1948,0,1);else if(a.endsWith("y")){let e=parseInt(a)||1;f.setFullYear(d.getFullYear()-e)}else if(a.endsWith("m")){let e=parseInt(a)||12;f.setMonth(d.getMonth()-e)}else f.setMonth(d.getMonth()-12);let p=s?m.slice(0,5):m,g=await u.getBatchSeriesData(p,{startDate:f.toISOString().split("T")[0],endDate:d.toISOString().split("T")[0]});if(!g||0===Object.keys(g).length)return c.warn("No labor data received from FRED"),n.NextResponse.json({error:"No labor data available",period:a,fast:s,seriesIds:p},{status:404});let S=function(e){let t=new Map;return Object.entries(e).forEach(([e,r])=>{r.forEach(r=>{let a=r.date;t.has(a)||t.set(a,{date:a});let s=t.get(a),i="number"==typeof r.value?r.value:parseFloat(r.value);switch(e){case"UNRATE":s.unemploymentRate=i;break;case"PAYEMS":s.nonfarmPayrolls=i;break;case"ICSA":s.initialClaims=i;break;case"CCSA":s.continuedClaims=i;break;case"IC4WSA":s.claims4Week=i;break;case"CIVPART":s.laborParticipation=i;break;case"EMRATIO":s.employmentPopulation=i;break;case"UNEMPLOY":s.unemployed=i;break;case"JTSJOL":s.jobOpenings=i;break;case"JTSQUR":s.quitsRate=i}})}),Array.from(t.values()).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime())}(g),T={timeSeries:S,metadata:{timestamp:new Date().toISOString(),period:a,fast:s,dataPoints:S.length,seriesCount:s?5:10,dataSource:"FRED",dateRange:{start:f.toISOString().split("T")[0],end:d.toISOString().split("T")[0]}}};return!function(e,t,r=3e5){h.set(e,{data:t,timestamp:Date.now(),ttl:r})}(i,T),c.info(`‚úÖ Successfully fetched ${S.length} labor data points`),n.NextResponse.json(T)}catch(e){return c.error("‚ùå Error fetching labor data:",e),n.NextResponse.json({error:"Failed to fetch labor data",details:e instanceof Error?e.message:"Unknown error",timestamp:new Date().toISOString()},{status:500})}}async function m(e){return n.NextResponse.json({},{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization, X-Requested-With","Access-Control-Max-Age":"86400"}})}let d=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/labor/route",pathname:"/api/labor",filename:"route",bundlePath:"app/api/labor/route"},resolvedPagePath:"/Users/philippebeliveau/Desktop/Notebook/gayed-signals-dashboard/apps/web/src/app/api/labor/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:f,workUnitAsyncStorage:p,serverHooks:g}=d;function S(){return(0,o.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:p})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48106:(e,t,r)=>{"use strict";e.exports=r(44870)},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},75492:(e,t,r)=>{"use strict";r.d(t,{TG:()=>o});let a={CASE_SHILLER:"CSUSHPINSA",HOUSING_STARTS:"HOUST",MONTHS_SUPPLY:"MSACSR",NEW_HOME_SALES:"HSN1F",EXISTING_HOME_SALES:"EXHOSLUSM495S",HOUSING_PERMITS:"PERMIT",MORTGAGE_RATES:"MORTGAGE30US",HOUSE_PRICE_INDEX:"USSTHPI"},s={UNEMPLOYMENT_RATE:"UNRATE",NONFARM_PAYROLLS:"PAYEMS",INITIAL_CLAIMS:"ICSA",CONTINUED_CLAIMS:"CCSA",CLAIMS_4WK_AVG:"IC4WSA",LABOR_PARTICIPATION:"CIVPART",EMPLOYMENT_POPULATION:"EMRATIO",JOBLESS_RATE:"UNEMPLOY",JOB_OPENINGS:"JTSJOL",QUITS_RATE:"JTSQUR"};class i{constructor(e){this.DEFAULT_TTL=36e5,this.DAILY_TTL=864e5,this.MONTHLY_TTL=2592e6,this.config={baseUrl:"https://api.stlouisfed.org/fred",rateLimit:120,...e},this.rateLimitInfo={remaining:this.config.rateLimit,resetTime:Date.now()+36e5,lastRequest:0},this.cache=new Map}async enforceRateLimit(){let e=Date.now();if(e>=this.rateLimitInfo.resetTime&&(this.rateLimitInfo.remaining=this.config.rateLimit,this.rateLimitInfo.resetTime=e+36e5),this.rateLimitInfo.remaining<=0){let t=this.rateLimitInfo.resetTime-e;console.warn(`FRED API rate limit exceeded. Waiting ${Math.ceil(t/1e3)} seconds...`),await new Promise(e=>setTimeout(e,t)),this.rateLimitInfo.remaining=this.config.rateLimit,this.rateLimitInfo.resetTime=e+36e5}let t=e-this.rateLimitInfo.lastRequest;t<1e3&&await new Promise(e=>setTimeout(e,1e3-t)),this.rateLimitInfo.remaining--,this.rateLimitInfo.lastRequest=Date.now()}getCachedData(e){let t=this.cache.get(e);return t?Date.now()>t.timestamp+t.ttl?(this.cache.delete(e),null):t.data:null}setCachedData(e,t,r=this.DEFAULT_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}cleanupCache(){let e=Date.now();for(let[t,r]of this.cache.entries())e>r.timestamp+r.ttl&&this.cache.delete(t)}async makeRequest(e,t={}){await this.enforceRateLimit();let r=new URL(`${this.config.baseUrl}/${e}`);for(let[e,a]of(r.searchParams.set("api_key",this.config.apiKey),r.searchParams.set("file_type","json"),Object.entries(t)))r.searchParams.set(e,a);console.log(`üîÑ FRED API Request: ${r.pathname}${r.search}`);try{let t=await fetch(r.toString(),{method:"GET",headers:{"User-Agent":"Housing-Labor-Market-Analysis/1.0",Accept:"application/json"}});if(!t.ok)throw Error(`FRED API error: ${t.status} ${t.statusText}`);let a=await t.json();return console.log(`‚úÖ FRED API Success: Retrieved data for ${e}`),a}catch(e){throw console.error("‚ùå FRED API Error:",e),Error(`Failed to fetch from FRED API: ${e instanceof Error?e.message:"Unknown error"}`)}}async getSeriesObservations(e,t={}){let r=`series_${e}_${JSON.stringify(t)}`,a=this.getCachedData(r);if(a)return console.log(`üöÄ Returning cached FRED data for series: ${e}`),a;let s={series_id:e};t.startDate&&(s.observation_start=t.startDate),t.endDate&&(s.observation_end=t.endDate),t.limit&&(s.limit=t.limit.toString()),t.offset&&(s.offset=t.offset.toString()),t.sortOrder&&(s.sort_order=t.sortOrder),t.transform&&(s.units=t.transform);try{let t=await this.makeRequest("series/observations",s);if(!t.observations||0===t.observations.length)return console.warn(`‚ö†Ô∏è No data returned for FRED series: ${e}`),[];let a=t.observations.filter(e=>"."!==e.value&&null!==e.value&&void 0!==e.value).map(e=>({...e,value:"string"==typeof e.value?parseFloat(e.value):e.value})),i=this.determineCacheTTL(e);return this.setCachedData(r,a,i),a}catch(t){throw console.error(`‚ùå Error fetching FRED series ${e}:`,t),t}}async getSeriesInfo(e){let t=`info_${e}`,r=this.getCachedData(t);if(r)return r;try{let r=await this.makeRequest("series",{series_id:e});if(!r.seriess||0===r.seriess.length)throw Error(`No series information found for: ${e}`);let a=r.seriess[0];return this.setCachedData(t,a,this.DAILY_TTL),a}catch(t){throw console.error(`‚ùå Error fetching FRED series info for ${e}:`,t),t}}async getBatchSeriesData(e,t={}){console.log(`üìä Fetching batch FRED data for ${e.length} series`);let r={};for(let a=0;a<e.length;a+=5){let s=e.slice(a,a+5).map(async e=>{try{let r=await this.getSeriesObservations(e,t);return{seriesId:e,data:r}}catch(t){return console.error(`‚ùå Error fetching series ${e}:`,t),{seriesId:e,data:[]}}});for(let{seriesId:e,data:t}of(await Promise.all(s)))r[e]=t;a+5<e.length&&await new Promise(e=>setTimeout(e,1e3))}return r}async getHousingMarketData(e={}){console.log("\uD83C\uDFE0 Fetching comprehensive housing market data from FRED...");let t=Object.values(a);return await this.getBatchSeriesData(t,e)}async getEmploymentMarketData(e={}){console.log("\uD83D\uDCBC Fetching comprehensive employment market data from FRED...");let t=Object.values(s);return await this.getBatchSeriesData(t,e)}async getLatestIndicators(){console.log("\uD83D\uDCC8 Fetching latest economic indicators...");let[e,t]=await Promise.all([this.getHousingMarketData({limit:1}),this.getEmploymentMarketData({limit:1})]),r=e=>{let t={};for(let[r,a]of Object.entries(e))if(a.length>0){let e=a[a.length-1];t[r]={value:"number"==typeof e.value?e.value:parseFloat(e.value),date:e.date}}return t};return{housing:r(e),employment:r(t)}}determineCacheTTL(e){return["CSUSHPINSA","HOUST","MSACSR","HSN1F","UNRATE","PAYEMS","CIVPART"].includes(e)?this.MONTHLY_TTL:["ICSA","CCSA","IC4WSA"].includes(e)?this.DEFAULT_TTL:this.DAILY_TTL}getRateLimitStatus(){return{...this.rateLimitInfo}}clearCache(){this.cache.clear(),console.log("\uD83D\uDDD1Ô∏è FRED API cache cleared")}getCacheStats(){return this.cleanupCache(),{size:this.cache.size,keys:Array.from(this.cache.keys())}}}function o(e){let t=e||process.env.FRED_API_KEY;if(!t)throw Error("FRED API key is required. Set FRED_API_KEY environment variable or pass as parameter.");return new i({apiKey:t})}},80408:()=>{},87032:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[620],()=>r(30585));module.exports=a})();