(()=>{var e={};e.id=427,e.ids=[427],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48106:(e,t,r)=>{"use strict";e.exports=r(44870)},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},75492:(e,t,r)=>{"use strict";r.d(t,{TG:()=>o});let s={CASE_SHILLER:"CSUSHPINSA",HOUSING_STARTS:"HOUST",MONTHS_SUPPLY:"MSACSR",NEW_HOME_SALES:"HSN1F",EXISTING_HOME_SALES:"EXHOSLUSM495S",HOUSING_PERMITS:"PERMIT",MORTGAGE_RATES:"MORTGAGE30US",HOUSE_PRICE_INDEX:"USSTHPI"},a={UNEMPLOYMENT_RATE:"UNRATE",NONFARM_PAYROLLS:"PAYEMS",INITIAL_CLAIMS:"ICSA",CONTINUED_CLAIMS:"CCSA",CLAIMS_4WK_AVG:"IC4WSA",LABOR_PARTICIPATION:"CIVPART",EMPLOYMENT_POPULATION:"EMRATIO",JOBLESS_RATE:"UNEMPLOY",JOB_OPENINGS:"JTSJOL",QUITS_RATE:"JTSQUR"};class i{constructor(e){this.DEFAULT_TTL=36e5,this.DAILY_TTL=864e5,this.MONTHLY_TTL=2592e6,this.config={baseUrl:"https://api.stlouisfed.org/fred",rateLimit:120,...e},this.rateLimitInfo={remaining:this.config.rateLimit,resetTime:Date.now()+36e5,lastRequest:0},this.cache=new Map}async enforceRateLimit(){let e=Date.now();if(e>=this.rateLimitInfo.resetTime&&(this.rateLimitInfo.remaining=this.config.rateLimit,this.rateLimitInfo.resetTime=e+36e5),this.rateLimitInfo.remaining<=0){let t=this.rateLimitInfo.resetTime-e;console.warn(`FRED API rate limit exceeded. Waiting ${Math.ceil(t/1e3)} seconds...`),await new Promise(e=>setTimeout(e,t)),this.rateLimitInfo.remaining=this.config.rateLimit,this.rateLimitInfo.resetTime=e+36e5}let t=e-this.rateLimitInfo.lastRequest;t<1e3&&await new Promise(e=>setTimeout(e,1e3-t)),this.rateLimitInfo.remaining--,this.rateLimitInfo.lastRequest=Date.now()}getCachedData(e){let t=this.cache.get(e);return t?Date.now()>t.timestamp+t.ttl?(this.cache.delete(e),null):t.data:null}setCachedData(e,t,r=this.DEFAULT_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}cleanupCache(){let e=Date.now();for(let[t,r]of this.cache.entries())e>r.timestamp+r.ttl&&this.cache.delete(t)}async makeRequest(e,t={}){await this.enforceRateLimit();let r=new URL(`${this.config.baseUrl}/${e}`);for(let[e,s]of(r.searchParams.set("api_key",this.config.apiKey),r.searchParams.set("file_type","json"),Object.entries(t)))r.searchParams.set(e,s);console.log(`üîÑ FRED API Request: ${r.pathname}${r.search}`);try{let t=await fetch(r.toString(),{method:"GET",headers:{"User-Agent":"Housing-Labor-Market-Analysis/1.0",Accept:"application/json"}});if(!t.ok)throw Error(`FRED API error: ${t.status} ${t.statusText}`);let s=await t.json();return console.log(`‚úÖ FRED API Success: Retrieved data for ${e}`),s}catch(e){throw console.error("‚ùå FRED API Error:",e),Error(`Failed to fetch from FRED API: ${e instanceof Error?e.message:"Unknown error"}`)}}async getSeriesObservations(e,t={}){let r=`series_${e}_${JSON.stringify(t)}`,s=this.getCachedData(r);if(s)return console.log(`üöÄ Returning cached FRED data for series: ${e}`),s;let a={series_id:e};t.startDate&&(a.observation_start=t.startDate),t.endDate&&(a.observation_end=t.endDate),t.limit&&(a.limit=t.limit.toString()),t.offset&&(a.offset=t.offset.toString()),t.sortOrder&&(a.sort_order=t.sortOrder),t.transform&&(a.units=t.transform);try{let t=await this.makeRequest("series/observations",a);if(!t.observations||0===t.observations.length)return console.warn(`‚ö†Ô∏è No data returned for FRED series: ${e}`),[];let s=t.observations.filter(e=>"."!==e.value&&null!==e.value&&void 0!==e.value).map(e=>({...e,value:"string"==typeof e.value?parseFloat(e.value):e.value})),i=this.determineCacheTTL(e);return this.setCachedData(r,s,i),s}catch(t){throw console.error(`‚ùå Error fetching FRED series ${e}:`,t),t}}async getSeriesInfo(e){let t=`info_${e}`,r=this.getCachedData(t);if(r)return r;try{let r=await this.makeRequest("series",{series_id:e});if(!r.seriess||0===r.seriess.length)throw Error(`No series information found for: ${e}`);let s=r.seriess[0];return this.setCachedData(t,s,this.DAILY_TTL),s}catch(t){throw console.error(`‚ùå Error fetching FRED series info for ${e}:`,t),t}}async getBatchSeriesData(e,t={}){console.log(`üìä Fetching batch FRED data for ${e.length} series`);let r={};for(let s=0;s<e.length;s+=5){let a=e.slice(s,s+5).map(async e=>{try{let r=await this.getSeriesObservations(e,t);return{seriesId:e,data:r}}catch(t){return console.error(`‚ùå Error fetching series ${e}:`,t),{seriesId:e,data:[]}}});for(let{seriesId:e,data:t}of(await Promise.all(a)))r[e]=t;s+5<e.length&&await new Promise(e=>setTimeout(e,1e3))}return r}async getHousingMarketData(e={}){console.log("\uD83C\uDFE0 Fetching comprehensive housing market data from FRED...");let t=Object.values(s);return await this.getBatchSeriesData(t,e)}async getEmploymentMarketData(e={}){console.log("\uD83D\uDCBC Fetching comprehensive employment market data from FRED...");let t=Object.values(a);return await this.getBatchSeriesData(t,e)}async getLatestIndicators(){console.log("\uD83D\uDCC8 Fetching latest economic indicators...");let[e,t]=await Promise.all([this.getHousingMarketData({limit:1}),this.getEmploymentMarketData({limit:1})]),r=e=>{let t={};for(let[r,s]of Object.entries(e))if(s.length>0){let e=s[s.length-1];t[r]={value:"number"==typeof e.value?e.value:parseFloat(e.value),date:e.date}}return t};return{housing:r(e),employment:r(t)}}determineCacheTTL(e){return["CSUSHPINSA","HOUST","MSACSR","HSN1F","UNRATE","PAYEMS","CIVPART"].includes(e)?this.MONTHLY_TTL:["ICSA","CCSA","IC4WSA"].includes(e)?this.DEFAULT_TTL:this.DAILY_TTL}getRateLimitStatus(){return{...this.rateLimitInfo}}clearCache(){this.cache.clear(),console.log("\uD83D\uDDD1Ô∏è FRED API cache cleared")}getCacheStats(){return this.cleanupCache(),{size:this.cache.size,keys:Array.from(this.cache.keys())}}}function o(e){let t=e||process.env.FRED_API_KEY;if(!t)throw Error("FRED API key is required. Set FRED_API_KEY environment variable or pass as parameter.");return new i({apiKey:t})}},80408:()=>{},86960:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>p,routeModule:()=>m,serverHooks:()=>f,workAsyncStorage:()=>S,workUnitAsyncStorage:()=>d});var s={};r.r(s),r.d(s,{GET:()=>u,OPTIONS:()=>g});var a=r(48106),i=r(48819),o=r(12050),n=r(4235),l=r(75492);let c={info:e=>console.log(`‚ÑπÔ∏è Housing API: ${e}`),warn:e=>console.warn(`‚ö†Ô∏è Housing API: ${e}`),error:(e,t)=>console.error(`‚ùå Housing API: ${e}`,t)},h=new Map;async function u(e){try{let t=Date.now();for(let[e,r]of h.entries())t>r.timestamp+r.ttl&&h.delete(e);let r=new URL(e.url),s=r.searchParams.get("period")||"12m",a="true"===r.searchParams.get("fast"),i=`housing_${s}_${a}`,o=function(e){let t=h.get(e);return t?Date.now()>t.timestamp+t.ttl?(h.delete(e),null):t.data:null}(i);if(o)return c.info(`üöÄ Returning cached housing data for period: ${s}`),n.NextResponse.json({...o,cached:!0,cacheTime:new Date().toISOString()});c.info(`üè† Fetching housing data for period: ${s}, fast: ${a}`);let u=(0,l.TG)(),g=["CSUSHPINSA","HOUST","MSACSR","HSN1F","EXHOSLUSM495S","PERMIT","MORTGAGE30US","USSTHPI"],m=new Date,S=new Date;if("max"===s||"all"===s)S.setFullYear(1987,0,1);else if(s.endsWith("y")){let e=parseInt(s)||1;S.setFullYear(m.getFullYear()-e)}else if(s.endsWith("m")){let e=parseInt(s)||12;S.setMonth(m.getMonth()-e)}else S.setMonth(m.getMonth()-12);let d=a?g.slice(0,4):g,f=await u.getBatchSeriesData(d,{startDate:S.toISOString().split("T")[0],endDate:m.toISOString().split("T")[0]});if(!f||0===Object.keys(f).length)return c.warn("No housing data received from FRED"),n.NextResponse.json({error:"No housing data available",period:s,fast:a,seriesIds:d},{status:404});let p=function(e){let t=new Map;return Object.entries(e).forEach(([e,r])=>{r.forEach(r=>{let s=r.date;t.has(s)||t.set(s,{date:s});let a=t.get(s),i="number"==typeof r.value?r.value:parseFloat(r.value);switch(e){case"CSUSHPINSA":a.caseSillerIndex=i;break;case"HOUST":a.housingStarts=i;break;case"MSACSR":a.monthsSupply=i;break;case"HSN1F":a.newHomeSales=i;break;case"EXHOSLUSM495S":a.existingHomeSales=i;break;case"PERMIT":a.housingPermits=i;break;case"MORTGAGE30US":a.mortgageRates=i;break;case"USSTHPI":a.housePriceIndex=i}})}),Array.from(t.values()).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime())}(f),T={timeSeries:p,metadata:{timestamp:new Date().toISOString(),period:s,fast:a,dataPoints:p.length,seriesCount:a?4:8,dataSource:"FRED",dateRange:{start:S.toISOString().split("T")[0],end:m.toISOString().split("T")[0]}}};return!function(e,t,r=3e5){h.set(e,{data:t,timestamp:Date.now(),ttl:r})}(i,T),c.info(`‚úÖ Successfully fetched ${p.length} housing data points`),n.NextResponse.json(T)}catch(e){return c.error("‚ùå Error fetching housing data:",e),n.NextResponse.json({error:"Failed to fetch housing data",details:e instanceof Error?e.message:"Unknown error",timestamp:new Date().toISOString()},{status:500})}}async function g(e){return n.NextResponse.json({},{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization, X-Requested-With","Access-Control-Max-Age":"86400"}})}let m=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/housing/route",pathname:"/api/housing",filename:"route",bundlePath:"app/api/housing/route"},resolvedPagePath:"/Users/philippebeliveau/Desktop/Notebook/gayed-signals-dashboard/apps/web/src/app/api/housing/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:S,workUnitAsyncStorage:d,serverHooks:f}=m;function p(){return(0,o.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:d})}},87032:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[620],()=>r(86960));module.exports=s})();