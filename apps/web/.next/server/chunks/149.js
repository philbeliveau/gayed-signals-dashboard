exports.id=149,exports.ids=[149],exports.modules={6299:(e,t,a)=>{"use strict";a.d(t,{kE:()=>n});var i=a(49165);class s{async healthCheck(){try{let e=await a.e(155).then(a.bind(a,96155)),t=await Promise.race([e.default.historical("SPY",{period1:new Date(Date.now()-864e5),period2:new Date,interval:"1d"}),new Promise((e,t)=>setTimeout(()=>t(Error("Health check timeout")),5e3))]);return Array.isArray(t)&&t.length>0}catch(e){return console.warn("Yahoo Finance health check failed:",e),!1}}async fetchData(e,t){let i=await a.e(155).then(a.bind(a,96155)),s={},r=this.parsePeriod(t),l=new Date(Date.now()-24*r*36e5);for(let t of e)try{let e=t.replace("^",""),a=await i.default.historical(t,{period1:l,period2:new Date,interval:"1d"});Array.isArray(a)&&a.length>0&&(s[e]=a.filter(e=>e&&"number"==typeof e.close&&e.close>0).map(t=>({date:t.date.toISOString().split("T")[0],symbol:e,close:t.close,volume:t.volume}))),await this.delay(this.rateLimit)}catch(e){console.error(`Yahoo Finance error for ${t}:`,e),s[t.replace("^","")]=[]}return s}parsePeriod(e){let t=e.match(/(\d+)([ymd])/);if(!t)return 730;let[,a,i]=t,s=parseInt(a);switch(i){case"y":return 365*s;case"m":return 30*s;case"d":return s;default:return 730}}delay(e){return new Promise(t=>setTimeout(t,e))}constructor(){this.name="yahoo-finance",this.priority=1,this.rateLimit=100,this.timeout=3e4}}class r{async healthCheck(){return!0}async fetchData(e,t){console.warn("Using fallback data provider - generating synthetic data");let a={},i=this.parsePeriod(t);for(let t of e){let e=t.replace("^","");a[e]=this.generateSyntheticData(e,i)}return a}parsePeriod(e){let t=e.match(/(\d+)([ymd])/);if(!t)return 730;let[,a,i]=t,s=parseInt(a);switch(i){case"y":return 365*s;case"m":return 30*s;case"d":return s;default:return 730}}generateSyntheticData(e,t){let a=[],i=this.getBasePriceForSymbol(e),s=i;for(let r=t;r>=0;r--){let t=new Date(Date.now()-24*r*36e5),l=(i-s)*.001;s*=1+(Math.random()-.5)*.02+l,a.push({date:t.toISOString().split("T")[0],symbol:e,close:Math.round(100*s)/100,volume:Math.floor(1e6*Math.random())+1e5})}return a}getBasePriceForSymbol(e){return({SPY:450,XLU:70,GLD:180,VIX:20,TLT:95,IEF:105,LBS:25})[e]||100}constructor(){this.name="fallback-static",this.priority=99,this.rateLimit=0,this.timeout=1e3}}class l{constructor(e){this.config=e,this.providers=[],this.cache=new Map,this.providerHealth=new Map,this.initializeProviders(),this.startHealthMonitoring()}initializeProviders(){this.providers=[new s,new r].sort((e,t)=>e.priority-t.priority)}startHealthMonitoring(){this.healthCheckInterval=setInterval(async()=>{for(let e of this.providers)try{let t=await e.healthCheck();this.providerHealth.set(e.name,t),t||1!==e.priority||i.$n.emit("alert",{id:`provider_health_${Date.now()}`,level:i.NY.WARNING,message:`Primary data provider ${e.name} is unhealthy`,timestamp:new Date,metadata:{provider:e.name}})}catch(t){this.providerHealth.set(e.name,!1),console.error(`Health check failed for ${e.name}:`,t)}},this.config.healthCheckInterval)}async fetchMarketDataWithFallback(e,t="2y"){let a=`${e.join(",")}_${t}`;if(this.config.cacheEnabled){let e=this.getCachedData(a);if(e)return{data:e.data,source:`${e.source} (cached)`,cached:!0,partial:!1}}for(let s of this.providers.filter(e=>!1!==this.providerHealth.get(e.name)))try{console.log(`Attempting to fetch data from ${s.name}...`);let r=await i.$n.executeWithRiskMitigation(()=>s.fetchData(e,t),`fetch_data_${s.name}`,{timeout:s.timeout}),l=this.validateDataCompleteness(r,e);if(l.isComplete||l.partialPercentage>.5)return this.config.cacheEnabled&&this.cacheData(a,r,s.name),{data:r,source:s.name,cached:!1,partial:!l.isComplete}}catch(e){console.error(`Provider ${s.name} failed:`,e);continue}if(this.config.cacheEnabled){let e=this.getStaleData(a);if(e)return i.$n.emit("alert",{id:`stale_data_${Date.now()}`,level:i.NY.WARNING,message:"Using stale cached data due to provider failures",timestamp:new Date,metadata:{cacheAge:Date.now()-e.timestamp.getTime()}}),{data:e.data,source:`${e.source} (stale cache)`,cached:!0,partial:!1}}throw Error("All data providers failed and no cached data available")}getCachedData(e){let t=this.cache.get(e);return t?new Date>t.expiryTime?(this.cache.delete(e),null):t:null}getStaleData(e){let t=this.cache.get(e);return!t||Date.now()-t.timestamp.getTime()>this.config.staleDataTolerance?null:t}cacheData(e,t,a){let i=new Date,s={data:t,timestamp:i,expiryTime:new Date(i.getTime()+this.config.cacheTTL),source:a};this.cache.set(e,s),this.cache.size>100&&this.cleanupCache()}cleanupCache(){let e=new Date;for(let[t,a]of this.cache.entries())e>a.expiryTime&&this.cache.delete(t)}validateDataCompleteness(e,t){let a=[],i=0;for(let s of t){let t=s.replace("^",""),r=e[t];r&&0!==r.length?i++:a.push(t)}let s=i/t.length;return{isComplete:0===a.length,partialPercentage:s,missingSymbols:a}}getProviderHealth(){let e={};for(let t of this.providers)e[t.name]=this.providerHealth.get(t.name)??!1;return e}getCacheStats(){let e=Date.now(),t=Array.from(this.cache.entries()).map(([t,a])=>({key:t,source:a.source,age:e-a.timestamp.getTime(),expiresIn:a.expiryTime.getTime()-e}));return{size:this.cache.size,entries:t}}clearCache(){this.cache.clear()}shutdown(){this.healthCheckInterval&&clearInterval(this.healthCheckInterval),this.cache.clear()}}let n=new l({cacheEnabled:!0,cacheTTL:9e5,staleDataTolerance:36e5,healthCheckInterval:6e4,maxConcurrentProviders:2})},48106:(e,t,a)=>{"use strict";e.exports=a(44870)},49165:(e,t,a)=>{"use strict";a.d(t,{$n:()=>o,NY:()=>s});var i=a(94735),s=function(e){return e.INFO="INFO",e.WARNING="WARNING",e.ERROR="ERROR",e.CRITICAL="CRITICAL",e}({});class r{constructor(e){this.config=e,this.state="CLOSED",this.failureCount=0,this.halfOpenRequestCount=0}async execute(e){if("OPEN"===this.state)if(this.shouldAttemptRecovery())this.state="HALF_OPEN",this.halfOpenRequestCount=0;else throw Error("Circuit breaker is OPEN - service unavailable");try{let t=await e();return this.onSuccess(),t}catch(e){throw this.onFailure(),e}}shouldAttemptRecovery(){return!this.lastFailureTime||Date.now()-this.lastFailureTime.getTime()>this.config.recoveryTimeout}onSuccess(){this.failureCount=0,this.state="CLOSED",this.halfOpenRequestCount=0}onFailure(){this.failureCount++,this.lastFailureTime=new Date,"HALF_OPEN"===this.state?this.state="OPEN":this.failureCount>=this.config.failureThreshold&&(this.state="OPEN")}getState(){return this.state}reset(){this.state="CLOSED",this.failureCount=0,this.lastFailureTime=void 0,this.halfOpenRequestCount=0}}class l{constructor(e){this.config=e,this.requests=[]}async checkLimit(){let e=Date.now(),t=e-this.config.windowSize;return this.requests=this.requests.filter(e=>e>t),!(this.requests.length>=this.config.maxRequestsPerMinute)&&(this.requests.push(e),!0)}getRequestCount(){return this.requests.length}reset(){this.requests=[]}}class n extends i.EventEmitter{constructor(e){super(),this.config=e,this.healthMetrics=[],this.alerts=[],this.startTime=new Date,this.requestStats={total:0,successful:0,failed:0,responseTimes:[]},this.circuitBreaker=new r(e.circuitBreaker),this.rateLimiter=new l(e.rateLimit),this.startHealthMonitoring()}static getInstance(e){if(!n.instance){if(!e)throw Error("RiskManager requires configuration on first initialization");n.instance=new n(e)}return n.instance}async executeWithRiskMitigation(e,t,a={}){let i=Date.now();try{if(!a.skipRateLimit&&!await this.rateLimiter.checkLimit())throw Error("Rate limit exceeded");let s=await this.circuitBreaker.execute(async()=>a.timeout?this.executeWithTimeout(e,a.timeout):e());return this.recordSuccess(i,t),s}catch(e){if(this.recordFailure(i,t,e),a.fallbackStrategy)try{let i=await this.executeFallbackStrategy(a.fallbackStrategy);return this.createAlert("WARNING",`Primary operation failed, fallback succeeded for ${t}`,{error:e instanceof Error?e.message:String(e)}),i}catch(a){this.createAlert("ERROR",`Both primary and fallback operations failed for ${t}`,{primaryError:e instanceof Error?e.message:String(e),fallbackError:a instanceof Error?a.message:String(a)})}throw this.createAlert("ERROR",`Operation failed: ${t}`,{error:e instanceof Error?e.message:String(e)}),e}}async executeWithTimeout(e,t){return Promise.race([e(),new Promise((e,a)=>setTimeout(()=>a(Error(`Operation timeout after ${t}ms`)),t))])}async executeFallbackStrategy(e){for(let t of e.fallbacks)try{if(!await Promise.race([e.healthCheck(),new Promise((t,a)=>setTimeout(()=>a(Error("Health check timeout")),e.timeout))]))continue;return{fallback:t,status:"success"}}catch(e){console.warn(`Fallback ${t} failed:`,e);continue}throw Error("All fallback strategies failed")}async retryWithBackoff(e,t,a){let i,s={...this.config.retry,...a};for(let a=1;a<=s.maxAttempts;a++)try{return await e()}catch(r){if(i=r instanceof Error?r:Error(String(r)),a===s.maxAttempts)break;let e=Math.min(s.baseDelay*Math.pow(s.backoffMultiplier,a-1),s.maxDelay);this.createAlert("WARNING",`Retry attempt ${a} failed for ${t}, retrying in ${e}ms`,{error:i.message,attempt:a,delay:e}),await this.delay(e)}throw i}delay(e){return new Promise(t=>setTimeout(t,e))}recordSuccess(e,t){let a=Date.now()-e;this.requestStats.total++,this.requestStats.successful++,this.requestStats.responseTimes.push(a),this.requestStats.responseTimes.length>1e3&&(this.requestStats.responseTimes=this.requestStats.responseTimes.slice(-1e3)),this.emit("operationSuccess",{context:t,responseTime:a})}recordFailure(e,t,a){let i=Date.now()-e;this.requestStats.total++,this.requestStats.failed++,this.requestStats.responseTimes.push(i),this.emit("operationFailure",{context:t,responseTime:i,error:a})}startHealthMonitoring(){this.healthCheckInterval=setInterval(()=>{let e=this.collectHealthMetrics();this.healthMetrics.push(e),this.healthMetrics.length>100&&(this.healthMetrics=this.healthMetrics.slice(-100)),this.checkHealthThresholds(e),this.emit("healthMetrics",e)},this.config.health.checkInterval)}collectHealthMetrics(){let e=process.memoryUsage(),t=this.requestStats.responseTimes.slice(-100),a=[...t].sort((e,t)=>e-t),i=Math.floor(.95*a.length),s=Math.floor(.99*a.length);return{timestamp:new Date,memory:{used:e.heapUsed/1024/1024,total:e.heapTotal/1024/1024,percentage:e.heapUsed/e.heapTotal*100},responseTime:{average:t.length>0?t.reduce((e,t)=>e+t,0)/t.length:0,p95:a[i]||0,p99:a[s]||0},errorRate:this.requestStats.total>0?this.requestStats.failed/this.requestStats.total*100:0,requestCount:this.requestStats.total,activeConnections:0,circuitBreakerState:this.circuitBreaker.getState()}}checkHealthThresholds(e){let{health:t}=this.config;e.memory.used>t.memoryThreshold&&this.createAlert("WARNING",`High memory usage: ${e.memory.used.toFixed(2)}MB (${e.memory.percentage.toFixed(1)}%)`,{memoryUsage:e.memory}),e.responseTime.average>t.responseTimeThreshold&&this.createAlert("WARNING",`High response time: ${e.responseTime.average.toFixed(2)}ms average`,{responseTime:e.responseTime}),e.errorRate>t.errorRateThreshold&&this.createAlert("ERROR",`High error rate: ${e.errorRate.toFixed(2)}%`,{errorRate:e.errorRate,requestCount:e.requestCount}),"OPEN"===e.circuitBreakerState&&this.createAlert("CRITICAL","Circuit breaker is OPEN - service degraded",{circuitBreakerState:e.circuitBreakerState})}createAlert(e,t,a){let i={id:`alert_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,level:e,message:t,timestamp:new Date,metadata:a};this.alerts.push(i),this.alerts.length>1e3&&(this.alerts=this.alerts.slice(-1e3)),this.emit("alert",i),this.config.alerts.enabled&&this.sendExternalAlert(i).catch(e=>{console.error("Failed to send external alert:",e)})}async sendExternalAlert(e){let{alerts:t}=this.config;if(t.webhookUrl)try{let a=await fetch(t.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok)throw Error(`Webhook failed: ${a.status}`)}catch(e){console.error("Webhook alert failed:",e)}}getHealthStatus(){let e=this.healthMetrics[this.healthMetrics.length-1]||null,t=Date.now()-this.startTime.getTime(),a="healthy";return e&&("OPEN"===this.circuitBreaker.getState()?a="unhealthy":(e.memory.used>this.config.health.memoryThreshold||e.responseTime.average>this.config.health.responseTimeThreshold||e.errorRate>this.config.health.errorRateThreshold)&&(a="degraded")),{status:a,metrics:e,uptime:t,circuitBreakerState:this.circuitBreaker.getState()}}getRecentAlerts(e=50){return this.alerts.slice(-e)}getStats(){return{requests:{...this.requestStats},health:[...this.healthMetrics],alerts:[...this.alerts],uptime:Date.now()-this.startTime.getTime()}}resetCircuitBreaker(){this.circuitBreaker.reset(),this.createAlert("INFO","Circuit breaker manually reset")}shutdown(){this.healthCheckInterval&&clearInterval(this.healthCheckInterval),this.createAlert("INFO","Risk manager shutting down"),this.emit("shutdown")}}let o=n.getInstance({circuitBreaker:{failureThreshold:5,recoveryTimeout:6e4,halfOpenRequestLimit:3},rateLimit:{maxRequestsPerMinute:60,burstLimit:10,windowSize:6e4},retry:{maxAttempts:3,baseDelay:1e3,maxDelay:3e4,backoffMultiplier:2},health:{checkInterval:3e4,memoryThreshold:512,responseTimeThreshold:5e3,errorRateThreshold:10},alerts:{enabled:!0}})},80408:()=>{},87032:()=>{},87046:(e,t,a)=>{"use strict";a.d(t,{_V:()=>o});var i=a(49165);class s{constructor(e){this.config=e}validateSymbols(e){let t=[],a=100;if(!Array.isArray(e))return{isValid:!1,errors:["Symbols must be an array"],securityScore:0};0===e.length&&(t.push("At least one symbol is required"),a-=20),e.length>50&&(t.push("Too many symbols requested (max 50)"),a-=30);let i=[];for(let s of e){let e=this.validateSingleSymbol(s);e.isValid?e.sanitizedData&&i.push(e.sanitizedData):(t.push(`Invalid symbol: ${e.errors.join(", ")}`),a-=10)}return{isValid:0===t.length,errors:t,sanitizedData:i,securityScore:Math.max(0,a)}}validateSingleSymbol(e){let t=[],a=100;if("string"!=typeof e)return{isValid:!1,errors:["Symbol must be a string"],securityScore:0};for(let s of(e.length>this.config.maxStringLength&&(t.push(`Symbol too long (max ${this.config.maxStringLength})`),a-=30),this.config.allowedSymbolPattern.test(e)||(t.push("Symbol contains invalid characters"),a-=50),this.config.blockedPatterns))s.test(e)&&(t.push("Symbol contains blocked pattern"),a-=70,i.$n.emit("alert",{id:`security_blocked_pattern_${Date.now()}`,level:i.NY.WARNING,message:`Blocked pattern detected in symbol: ${e}`,timestamp:new Date,metadata:{symbol:e,pattern:s.source}}));let s=this.sanitizeString(e);return{isValid:0===t.length,errors:t,sanitizedData:s,securityScore:Math.max(0,a)}}validatePeriod(e){let t=[],a=100;return"string"!=typeof e?{isValid:!1,errors:["Period must be a string"],securityScore:0}:(/^(1d|5d|1m|3m|6m|1y|2y|5y|10y|ytd|max|\d+[dmy])$/.test(e)||(t.push("Invalid period format"),a-=50),{isValid:0===t.length,errors:t,sanitizedData:e,securityScore:a})}sanitizeString(e){let t=e.trim();return this.config.sanitizeHtml&&(t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")),t=t.replace(/[\x00-\x1F\x7F]/g,"")}}class r{constructor(e){this.config=e,this.requests=new Map,this.suspiciousIPs=new Set}checkRateLimit(e){if(!this.config.enabled)return{allowed:!0,remaining:1/0,resetTime:0};let t=Date.now(),a=t-this.config.windowMs,i=(this.requests.get(e)||[]).filter(e=>e>a);return i.length>=this.config.maxRequests?(this.markSuspiciousIP(e),{allowed:!1,remaining:0,resetTime:Math.min(...i)+this.config.windowMs}):(i.push(t),this.requests.set(e,i),{allowed:!0,remaining:this.config.maxRequests-i.length,resetTime:t+this.config.windowMs})}markSuspiciousIP(e){this.suspiciousIPs.has(e)||(this.suspiciousIPs.add(e),i.$n.emit("alert",{id:`rate_limit_exceeded_${Date.now()}`,level:i.NY.WARNING,message:`Rate limit exceeded for IP: ${e}`,timestamp:new Date,metadata:{ip:e,type:"rate_limit"}}))}getSuspiciousIPs(){return Array.from(this.suspiciousIPs)}clearIP(e){this.requests.delete(e),this.suspiciousIPs.delete(e)}getStats(){let e=Array.from(this.requests.values()).reduce((e,t)=>e+t.length,0);return{totalIPs:this.requests.size,suspiciousIPs:this.suspiciousIPs.size,totalRequests:e}}}class l{constructor(e){this.config=e}validateRequest(e){let t=[],a=100;for(let i of(this.config.allowedMethods.includes(e.method)||(t.push(`Method ${e.method} not allowed`),a-=30),this.config.requiredHeaders))e.headers[i.toLowerCase()]||(t.push(`Missing required header: ${i}`),a-=20);if(this.config.validateContentType&&e.body){let i=e.headers["content-type"];i&&i.includes("application/json")||(t.push("Invalid content type"),a-=25)}if(e.body){let i=JSON.stringify(e.body).length;i>this.config.maxBodySize&&(t.push(`Request body too large (${i} > ${this.config.maxBodySize})`),a-=40)}return(!e.userAgent||e.userAgent.length<10)&&(t.push("Suspicious or missing user agent"),a-=15),{isValid:0===t.length,errors:t,securityScore:Math.max(0,a)}}}class n{constructor(e){this.config=e,this.securityEvents=[],this.inputValidator=new s(e.inputValidation),this.rateLimiter=new r(e.rateLimiting),this.requestValidator=new l(e.requestValidation)}async validateAPIRequest(e,t){let a=[],i=100,s=this.rateLimiter.checkRateLimit(e.ip);s.allowed||(a.push("Rate limit exceeded"),i=0);let r=this.requestValidator.validateRequest(e);r.isValid||(a.push(...r.errors),i=Math.min(i,r.securityScore));let l=this.inputValidator.validateSymbols(t.symbols),n=this.inputValidator.validatePeriod(t.period||"2y");return l.isValid||(a.push(...l.errors),i=Math.min(i,l.securityScore)),n.isValid||(a.push(...n.errors),i=Math.min(i,n.securityScore)),this.logSecurityEvent("api_validation",{ip:e.ip,path:e.path,isValid:0===a.length,securityScore:i,errors:a.length>0?a:void 0}),{isValid:0===a.length,errors:a,sanitizedData:{symbols:l.sanitizedData||[],period:n.sanitizedData||"2y"},securityScore:i,rateLimitInfo:s}}getSecurityHeaders(){let e={};if(this.config.security.secureHeaders&&(e["X-Content-Type-Options"]="nosniff",e["X-Frame-Options"]="DENY",e["X-XSS-Protection"]="1; mode=block",e["Strict-Transport-Security"]="max-age=31536000; includeSubDomains",e["Referrer-Policy"]="strict-origin-when-cross-origin",e["Content-Security-Policy"]="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline';"),this.config.security.enableCORS){let t=this.config.security.allowedOrigins.join(" ");e["Access-Control-Allow-Origin"]=t||"*",e["Access-Control-Allow-Methods"]="GET, POST, OPTIONS",e["Access-Control-Allow-Headers"]="Content-Type, Authorization"}return e}logSecurityEvent(e,t){if(this.securityEvents.push({timestamp:new Date,event:e,metadata:t}),this.securityEvents.length>1e3&&(this.securityEvents=this.securityEvents.slice(-1e3)),t&&"object"==typeof t&&"securityScore"in t){let a=t.securityScore;a<50&&i.$n.emit("alert",{id:`security_risk_${Date.now()}`,level:a<20?i.NY.CRITICAL:i.NY.WARNING,message:`Low security score detected: ${a}`,timestamp:new Date,metadata:{event:e,...t}})}}getSecurityStats(){return{rateLimiting:this.rateLimiter.getStats(),events:{total:this.securityEvents.length,recent:this.securityEvents.slice(-50)},suspiciousIPs:this.rateLimiter.getSuspiciousIPs()}}clearIP(e){this.rateLimiter.clearIP(e)}}let o=new n({rateLimiting:{enabled:!0,windowMs:9e5,maxRequests:100,skipSuccessfulRequests:!1},inputValidation:{maxStringLength:50,allowedSymbolPattern:/^[A-Z0-9^.\-_]{1,10}$/,blockedPatterns:[/(<script|javascript:|on\w+\s*=)/i,/(union|select|insert|update|delete|drop|create|alter)/i,/(exec|eval|system|cmd)/i,/[<>{}[\]]/g],sanitizeHtml:!0},requestValidation:{maxBodySize:10240,requiredHeaders:["user-agent"],allowedMethods:["GET","POST","OPTIONS"],validateContentType:!0},security:{enableCSRF:!0,enableCORS:!0,allowedOrigins:["http://localhost:3000","https://localhost:3000"],secureHeaders:!0}})},88010:(e,t,a)=>{"use strict";a.d(t,{B:()=>r});var i=a(49165);class s{constructor(){this.fallbackStrategies=new Map,this.emergencyData={},this.currentDegradationLevel=this.getFullServiceLevel(),this.serviceStatus={dataFetching:"healthy",signalCalculation:"healthy",consensus:"healthy",alerts:"healthy"},this.initializeFallbackStrategies(),this.loadEmergencyData()}initializeFallbackStrategies(){this.fallbackStrategies.set("dataFetching",async()=>this.provideEmergencyData()),this.fallbackStrategies.set("signalCalculation",async()=>this.provideSimplifiedSignals()),this.fallbackStrategies.set("consensus",async()=>this.provideBasicConsensus())}async processMarketDataWithDegradation(e,t){let a=[],i=[],s=100;try{let r=await t(),l=this.validateDataCompleteness(r,e);if(l.percentage<100&&(a.push(`Data incomplete: ${l.percentage.toFixed(1)}% of requested symbols available`),s=l.percentage,l.percentage<50)){let e=await this.provideEmergencyData(l.missingSymbols);Object.assign(r,e),i.push("emergency_data"),s=Math.max(s,60)}let n=this.calculateDegradationLevel(s,a.length);return{data:r,degradationLevel:n,warnings:a,fallbacksUsed:i,reliability:s,timestamp:new Date}}catch(t){a.push(`Primary data source failed: ${t instanceof Error?t.message:"Unknown error"}`);try{let t=await this.provideEmergencyData(e);i.push("complete_emergency_fallback"),s=30;let r=this.calculateDegradationLevel(s,a.length);return{data:t,degradationLevel:r,warnings:a,fallbacksUsed:i,reliability:s,timestamp:new Date}}catch(e){return a.push(`Emergency data also failed: ${e instanceof Error?e.message:"Unknown error"}`),s=0,{data:{},degradationLevel:this.getEmergencyLevel(),warnings:a,fallbacksUsed:["complete_failure"],reliability:s,timestamp:new Date}}}}async calculateSignalsWithDegradation(e,t){let a=[],i=[],s=[],r=[],l=0;for(let[n,o]of Object.entries(t))try{let t=o(e);t.length>0?(s.push(...t),l+=100):(a.push(`No signals generated for ${n}`),l+=50)}catch(o){let t=o instanceof Error?o.message:"Unknown error";r.push({type:n,error:t});try{let t=await this.calculateFallbackSignal(n,e);t.length>0?(s.push(...t),r[r.length-1].fallbackUsed=!0,i.push(`${n}_fallback`),l+=70):l+=20}catch{a.push(`Both primary and fallback calculations failed for ${n}`),l+=0}}let n=l/Object.keys(t).length;return{data:{availableSignals:s,failedSignals:r,dataCompleteness:this.calculateDataCompleteness(e)},degradationLevel:this.calculateDegradationLevel(n,a.length),warnings:a,fallbacksUsed:i,reliability:n,timestamp:new Date}}async calculateConsensusWithDegradation(e,t){let a=[],i=[],s=100;if(0===e.length)return a.push("No signals available for consensus calculation"),{data:null,degradationLevel:this.getEmergencyLevel(),warnings:a,fallbacksUsed:i,reliability:0,timestamp:new Date};try{let r=t(e);e.length<3&&(a.push("Limited signals available for consensus (< 3)"),s=70),r.confidence<.6&&(a.push("Low consensus confidence"),s=Math.min(s,60));let l=this.calculateDegradationLevel(s,a.length);return{data:r,degradationLevel:l,warnings:a,fallbacksUsed:i,reliability:s,timestamp:new Date}}catch(t){a.push(`Consensus calculation failed: ${t instanceof Error?t.message:"Unknown error"}`);try{let t=this.calculateSimplifiedConsensus(e);return i.push("simplified_consensus"),s=50,{data:t,degradationLevel:this.calculateDegradationLevel(s,a.length),warnings:a,fallbacksUsed:i,reliability:s,timestamp:new Date}}catch(e){return a.push(`Simplified consensus also failed: ${e instanceof Error?e.message:"Unknown error"}`),{data:null,degradationLevel:this.getEmergencyLevel(),warnings:a,fallbacksUsed:i,reliability:0,timestamp:new Date}}}}async provideEmergencyData(e){let t=e||["SPY","XLU","GLD","VIX","TLT","IEF","LBS"],a={};for(let e of t)this.emergencyData[e]?a[e]=this.emergencyData[e]:a[e]=this.generateMinimalSyntheticData(e);return i.$n.emit("alert",{id:`emergency_data_${Date.now()}`,level:i.NY.CRITICAL,message:"Using emergency data due to complete data source failure",timestamp:new Date,metadata:{symbols:t}}),a}async calculateFallbackSignal(e,t){let a=new Date().toISOString().split("T")[0];switch(e){case"utilities_spy":return this.calculateSimpleUtilitiesSignal(t,a);case"lumber_gold":return this.calculateSimpleLumberGoldSignal(t,a);case"treasury_curve":return this.calculateSimpleTreasurySignal(t,a);case"sp500_ma":return this.calculateSimpleMovingAverageSignal(t,a);case"vix_defensive":return this.calculateSimpleVixSignal(t,a);default:return[]}}calculateSimpleUtilitiesSignal(e,t){let a=e.SPY,i=e.XLU;if(!a||!i||0===a.length||0===i.length)return[];let s=a[a.length-1],r=i[i.length-1],l=a.length>1?(s.close-a[a.length-2].close)/a[a.length-2].close:0,n=i.length>1?(r.close-i[i.length-2].close)/i[i.length-2].close:0;return[{date:t,type:"utilities_spy",signal:n>l?"Risk-Off":"Risk-On",strength:"Weak",confidence:.3,rawValue:n-l,metadata:{fallback:!0,spyChange:l,xuChange:n}}]}calculateSimpleLumberGoldSignal(e,t){let a=e.LBS,i=e.GLD;if(!a||!i||0===a.length||0===i.length)return[];let s=a[a.length-1],r=i[i.length-1],l=s.close/r.close;return[{date:t,type:"lumber_gold",signal:l>.15?"Risk-On":"Risk-Off",strength:"Weak",confidence:.3,rawValue:l,metadata:{fallback:!0,ratio:l}}]}calculateSimpleTreasurySignal(e,t){let a=e.TLT,i=e.IEF;if(!a||!i||0===a.length||0===i.length)return[];let s=a[a.length-1],r=i[i.length-1],l=s.close/r.close;return[{date:t,type:"treasury_curve",signal:l>.9?"Risk-Off":"Risk-On",strength:"Weak",confidence:.3,rawValue:l,metadata:{fallback:!0,ratio:l}}]}calculateSimpleMovingAverageSignal(e,t){let a=e.SPY;if(!a||a.length<50)return[];let i=a[a.length-1],s=a.slice(-50).reduce((e,t)=>e+t.close,0)/50;return[{date:t,type:"sp500_ma",signal:i.close>s?"Risk-On":"Risk-Off",strength:"Weak",confidence:.3,rawValue:(i.close-s)/s,metadata:{fallback:!0,ma50:s,current:i.close}}]}calculateSimpleVixSignal(e,t){let a=e.VIX;if(!a||0===a.length)return[];let i=a[a.length-1];return[{date:t,type:"vix_defensive",signal:i.close>25?"Risk-Off":"Risk-On",strength:"Weak",confidence:.3,rawValue:i.close,metadata:{fallback:!0,vix:i.close}}]}calculateSimplifiedConsensus(e){let t,a,i=e.filter(e=>"Risk-On"===e.signal).length,s=e.filter(e=>"Risk-Off"===e.signal).length;return i>s?(t="Risk-On",a=i/e.length):s>i?(t="Risk-Off",a=s/e.length):(t="Mixed",a=.5),{date:new Date().toISOString().split("T")[0],consensus:t,confidence:Math.max(.3,a),riskOnCount:i,riskOffCount:s,signals:e}}loadEmergencyData(){console.log("Emergency data system initialized")}generateMinimalSyntheticData(e){let t=[],a=this.getBasePriceForSymbol(e);for(let i=30;i>=0;i--){let s=new Date(Date.now()-24*i*36e5);t.push({date:s.toISOString().split("T")[0],symbol:e,close:a*(1+(Math.random()-.5)*.02),volume:1e6})}return t}getBasePriceForSymbol(e){return({SPY:450,XLU:70,GLD:180,VIX:20,TLT:95,IEF:105,LBS:25})[e]||100}validateDataCompleteness(e,t){let a=t.filter(t=>{let a=t.replace("^","");return!e[a]||0===e[a].length});return{percentage:(t.length-a.length)/t.length*100,missingSymbols:a}}calculateDataCompleteness(e){let t={};for(let[a,i]of Object.entries(e))0===i.length?t[a]=0:t[a]=Math.min(100,i.length/252*100);return t}calculateDegradationLevel(e,t){return e>=90&&0===t?this.getFullServiceLevel():e>=70&&t<=2?this.getPartialServiceLevel():e>=40&&t<=5?this.getMinimalServiceLevel():this.getEmergencyLevel()}getFullServiceLevel(){return{level:"full",description:"All services operating normally",availableFeatures:["real_time_data","all_signals","consensus","alerts","history"],disabledFeatures:[],dataReliability:100}}getPartialServiceLevel(){return{level:"partial",description:"Some services degraded, core functionality available",availableFeatures:["real_time_data","most_signals","consensus","alerts"],disabledFeatures:["history","advanced_analytics"],dataReliability:80}}getMinimalServiceLevel(){return{level:"minimal",description:"Limited functionality, basic signals only",availableFeatures:["basic_signals","simple_consensus"],disabledFeatures:["real_time_data","advanced_signals","history","alerts"],dataReliability:50}}getEmergencyLevel(){return{level:"emergency",description:"Emergency mode - synthetic data only",availableFeatures:["emergency_data","status_updates"],disabledFeatures:["real_time_data","signals","consensus","alerts","history"],dataReliability:20}}getCurrentDegradationLevel(){return this.currentDegradationLevel}updateServiceStatus(e,t){this.serviceStatus[e]=t;let a=Object.values(this.serviceStatus),i=a.filter(e=>"healthy"===e).length/a.length*100;this.currentDegradationLevel=this.calculateDegradationLevel(i,0)}getServiceStatus(){return{...this.serviceStatus}}async provideSimplifiedSignals(){return[{date:new Date().toISOString(),type:"sp500_ma",signal:"Neutral",strength:"Weak",confidence:.3,rawValue:0,metadata:{fallback:!0,source:"emergency"}}]}async provideBasicConsensus(){return{date:new Date().toISOString(),consensus:"Mixed",confidence:.2,riskOnCount:0,riskOffCount:0,signals:[]}}}let r=new s},95956:(e,t,a)=>{"use strict";a.d(t,{y1:()=>o});var i=a(49165),s=a(6299),r=a(88010),l=a(87046);class n{constructor(e){this.config=e,this.stats={totalRequests:0,successfulRequests:0,failedRequests:0,averageResponseTime:0,lastRequestTime:null}}async fetchMarketDataSecure(e,t="2y",a){let n=Date.now(),o=[],c=100;try{let h;if(this.config.enableSecurity){let i=await l._V.validateAPIRequest({ip:a.ip,userAgent:a.userAgent,method:"GET",path:"/api/signals",headers:{},timestamp:a.timestamp},{symbols:e,period:t});if(!i.isValid)throw Error(`Security validation failed: ${i.errors.join(", ")}`);(c=i.securityScore)<70&&o.push("Low security score detected"),e=i.sanitizedData.symbols,t=i.sanitizedData.period}if(this.config.enableDataFallback){let a=await s.kE.fetchMarketDataWithFallback(e,t);h={data:a.data,metadata:{source:a.source,cached:a.cached,partial:a.partial,reliability:a.cached?80:100,responseTime:Date.now()-n,warnings:a.partial?["Partial data returned"]:[],fallbacksUsed:a.source.includes("fallback")?[a.source]:[],securityScore:c}}}else if(this.config.enableRiskManagement){let a=await i.$n.executeWithRiskMitigation(()=>this.fetchDataDirect(e,t),"yahoo_finance_fetch",{timeout:this.config.timeout});h={data:a,metadata:{source:"yahoo-finance",cached:!1,partial:!1,reliability:this.calculateDataReliability(a,e),responseTime:Date.now()-n,warnings:[],fallbacksUsed:[],securityScore:c}}}else{let a=await this.fetchDataDirect(e,t);h={data:a,metadata:{source:"yahoo-finance-direct",cached:!1,partial:!1,reliability:this.calculateDataReliability(a,e),responseTime:Date.now()-n,warnings:[],fallbacksUsed:[],securityScore:c}}}if(this.config.enableGracefulDegradation){let t=await r.B.processMarketDataWithDegradation(e,async()=>h.data);h.degradation=t,h.metadata.warnings.push(...t.warnings),h.metadata.fallbacksUsed.push(...t.fallbacksUsed),h.metadata.reliability=Math.min(h.metadata.reliability,t.reliability)}return this.updateStats(!0,h.metadata.responseTime),h}catch(t){if(this.updateStats(!1,Date.now()-n),this.config.enableGracefulDegradation)try{let a=await r.B.processMarketDataWithDegradation(e,async()=>{throw t});return{data:a.data,metadata:{source:"emergency-fallback",cached:!1,partial:!0,reliability:a.reliability,responseTime:Date.now()-n,warnings:[...o,...a.warnings],fallbacksUsed:[...a.fallbacksUsed],securityScore:c},degradation:a}}catch(e){throw i.$n.emit("alert",{id:`complete_failure_${Date.now()}`,level:i.NY.CRITICAL,message:"Complete system failure - all fallbacks exhausted",timestamp:new Date,metadata:{originalError:t instanceof Error?t.message:String(t),degradationError:e instanceof Error?e.message:String(e)}}),Error(`Complete system failure: ${t instanceof Error?t.message:String(t)}`)}throw t}}async fetchDataDirect(e,t){let i=await a.e(155).then(a.bind(a,96155)),s={},r=this.parsePeriod(t),l=new Date(Date.now()-24*r*36e5);for(let t of e)try{let e=t.replace("^",""),a=await i.default.historical(t,{period1:l,period2:new Date,interval:"1d"});if(Array.isArray(a)&&a.length>0){let t=a.filter(e=>e&&"number"==typeof e.close&&e.close>0&&isFinite(e.close)).map(t=>({date:t.date.toISOString().split("T")[0],symbol:e,close:t.close,volume:t.volume}));s[e]=t}else s[e]=[];await this.delay(this.config.rateLimit)}catch(e){console.error(`Error fetching ${t}:`,e),s[t.replace("^","")]=[]}return s}async fetchMarketData(e,t="2y"){let a={ip:"127.0.0.1",userAgent:"Yahoo Finance Client",symbols:e,period:t,timestamp:new Date};return(await this.fetchMarketDataSecure(e,t,a)).data}async healthCheck(){let e,t=Date.now(),r={yahoo_finance:!1,risk_management:!0,data_fallback:!0,security:!0};try{let e=await a.e(155).then(a.bind(a,96155)),t=await Promise.race([e.default.historical("SPY",{period1:new Date(Date.now()-864e5),period2:new Date,interval:"1d"}),new Promise((e,t)=>setTimeout(()=>t(Error("Health check timeout")),5e3))]);r.yahoo_finance=Array.isArray(t)&&t.length>0}catch{r.yahoo_finance=!1}r.risk_management="unhealthy"!==i.$n.getHealthStatus().status,r.data_fallback=Object.values(s.kE.getProviderHealth()).some(e=>e);let l=Date.now()-t;return{status:r.yahoo_finance&&r.risk_management?"healthy":r.data_fallback||r.risk_management?"degraded":"unhealthy",details:r,responseTime:l}}calculateDataReliability(e,t){let a=t.length;return t.filter(t=>{let a=t.replace("^","");return e[a]&&e[a].length>0}).length/a*100}parsePeriod(e){let t=e.match(/(\d+)([ymd])/);if(!t)return 730;let[,a,i]=t,s=parseInt(a);switch(i){case"y":return 365*s;case"m":return 30*s;case"d":return s;default:return 730}}delay(e){return new Promise(t=>setTimeout(t,e))}updateStats(e,t){this.stats.totalRequests++,this.stats.lastRequestTime=new Date,e?this.stats.successfulRequests++:this.stats.failedRequests++,this.stats.averageResponseTime=(this.stats.averageResponseTime*(this.stats.totalRequests-1)+t)/this.stats.totalRequests}getStats(){return{...this.stats}}getRateLimit(){return this.config.rateLimit}getMaxRetries(){return this.config.maxRetries}getTimeout(){return this.config.timeout}resetStats(){this.stats={totalRequests:0,successfulRequests:0,failedRequests:0,averageResponseTime:0,lastRequestTime:null}}}let o=new n({rateLimit:100,maxRetries:3,timeout:3e4,enableRiskManagement:!0,enableSecurity:!0,enableGracefulDegradation:!0,enableDataFallback:!0})}};