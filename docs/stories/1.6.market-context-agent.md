# Story 1.6: market-context-agent

## Status
Draft

## Story
**As a** financial advisor,
**I want** a Market Context AutoGen agent that provides real-time market intelligence,
**so that** I understand current economic conditions affecting signal analysis.

## Acceptance Criteria
1. Market Context agent utilizes existing Perplexity MCP integration from current fact-checking system
2. Agent has access to existing FRED economic data through current `fred-api-client.ts`
3. Agent can query current economic indicators using existing `economic-data-pipeline.ts`
4. Agent provides real-time market news and context relevant to current signal states
5. Agent integrates breaking news analysis with quantitative signal data
6. Agent maintains awareness of Federal Reserve policy, employment data, and market developments
7. Agent responses contextualize current signals within broader economic environment
8. Agent leverages existing `web-search-service.ts` for additional market intelligence
9. Agent output includes specific references to current economic data and news sources
10. Agent conversations enhance rather than replace existing signal calculation accuracy
11. **CRITICAL**: Agent NEVER uses fallback or synthetic data - explicitly states when data is unavailable
12. Agent reduces confidence levels and explains limitations when economic data sources are inaccessible

## Tasks / Subtasks
- [ ] Integrate with existing MCP services (AC: 1, 8)
  - [ ] Connect to Perplexity MCP integration
  - [ ] Utilize web-search-service.ts for market intelligence
- [ ] Connect to economic data sources (AC: 2, 3)
  - [ ] Integrate with fred-api-client.ts
  - [ ] Connect to economic-data-pipeline.ts
- [ ] Implement real-time market analysis (AC: 4, 5)
  - [ ] Develop real-time news processing
  - [ ] Integrate breaking news with signal data
- [ ] Add economic context capabilities (AC: 6, 7)
  - [ ] Federal Reserve policy awareness
  - [ ] Employment data integration
  - [ ] Signal contextualization within economic environment
- [ ] Ensure quality and accuracy (AC: 9, 10, 11, 12)
  - [ ] Include specific data and news source references
  - [ ] Enhance rather than replace existing signal accuracy
  - [ ] Implement no-fallback data integrity: explicitly state when data unavailable
  - [ ] Implement confidence degradation when data sources are missing

## Dev Notes

### Relevant Source Tree Info
- Perplexity MCP integration - Current fact-checking system patterns
- `src/domains/market-data/services/fred-api-client.ts` - FRED economic data access
- `src/domains/market-data/services/economic-data-pipeline.ts` - Economic indicator processing
- `src/lib/fact-check/web-search-service.ts` - Additional market intelligence source
- `src/domains/risk-management/utils/safla-validator.ts` - Data integrity validation patterns

### Market Intelligence Scope
Market Context agent should provide:
- Real-time economic news and analysis
- Federal Reserve policy updates and implications
- Employment data context
- Market sentiment and development tracking
- Economic indicator interpretation

**Data Integrity Principles:**
- **Transparency Over Convenience**: Explicitly state when data is unavailable
- **No Synthetic Fallbacks**: Never generate or substitute fake economic data
- **Source Attribution**: Specify exactly which data sources are accessible/inaccessible
- **Confidence Degradation**: Reduce confidence when missing critical economic indicators

**Example Response Pattern:**
```
✅ GOOD: "Federal Reserve employment data currently unavailable from FRED API. Analysis proceeding with available Perplexity market intelligence only. Confidence level reduced to 60% due to missing employment indicators."
❌ BAD: "FRED data unavailable, using estimated employment figures..."
```

### Integration Approach
Leverage existing sophisticated data sources without rebuilding. Agent should enhance current signal calculations with broader economic context.

### Key Constraints
- Must use existing MCP integrations without modification
- Cannot compromise existing signal calculation accuracy
- Must provide specific source references for credibility
- Real-time capabilities should not impact system performance
- **CRITICAL**: NO fallback or synthetic data - financial-grade data integrity required
- Must explicitly communicate data unavailability rather than fabricating information
- Confidence levels must reflect actual data availability and quality

### Testing
**Testing Standards:**
- Integration tests with all existing data sources
- Real-time data processing performance tests
- Accuracy tests for economic context analysis
- End-to-end tests for market intelligence conversations
- Regression tests for existing MCP and data pipeline functionality
- **Data integrity tests**: Verify agent behavior when data sources are unavailable
- **Confidence degradation tests**: Validate confidence adjustment when data missing
- **No-fallback validation**: Ensure agent never uses synthetic economic data

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-21 | 1.0 | Initial story creation | John (PM) |
| 2025-01-28 | 1.1 | Added no-fallback data integrity requirements and file paths | Sarah (PO) |

## Dev Agent Record
_(This section is owned by dev-agent and can only be modified by dev-agent)_

## QA Results
_(This section is owned by qa-agent and can only be modified by qa-agent)_